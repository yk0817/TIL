# アーキテクチャ

## 3層アーキテクチャ

- 一般的なWebアプリケーションで使用されるアーキテクチャ
  - プレゼンテーション層
  - ビジネスロジック層
  - データアクセス層

このアーキテクチャの問題点として低凝集となりがち

## なぜ、低凝集になりがちか？

- ユースケースとドメイン知識を混合しがち
  - ユースケース
    - システムの振る舞い
  - ドメイン知識
    - ドメインに関するルール、制約
  - ユースケース、ドメインをわけることで、クラスの役割(責務)がはっきりする。

## レイヤードアーキテクチャ

- エバンス本で紹介されているアーキテクチャ
  - プレゼンテーション層
  - アプリケーション層
  - ドメイン層
  - インフラ層

問題点: インフラ層がドメイン層に依存してしまう。
ex) ドメイン層にリポジトリ(DBからデータをとったり、更新する層)置く場合、リポジトリがDBやORマッパーに依存

## オニオンアーキテクチャ

- 依存関係逆転の原則(wikiより)
  - 上位レベルのモジュールは下位レベルのモジュールに依存すべきではない。両方とも抽象（abstractions)に依存すべきである。
  - 抽象は詳細に依存してはならない。詳細が抽象に依存すべきである。

※具体的にイメージするには [この記事](http://harumi.sakura.ne.jp/wordpress/2019/07/04/%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E9%80%86%E8%BB%A2%E3%81%AE%E5%8E%9F%E5%89%87dip/) がわかりやすい。

依存関係逆転の原則をレイヤードアーキテクチャの話で考えると、
インターフェイスをドメインに、実装をインフラ層にすれば、ドメインはインフラに依存する形となり、レイヤーごとの責務がわかれる。

- 実装する層
  - ドメイン層
    - ドメイン知識を表現
      - ドメインオブジェクト
        - エンティティ
        - 値オブジェクト
        - ドメインイベント
      - ドメインオブジェクトを利用するクラス
        - リポジトリのインターフェイス
        - ドメインサービス
        - ファクトリー
  - ユースケース層
  - プレゼンテーション層
  - インフラ層

## 境界づけられたコンテキストの実装

どのようにコンテキストを実装すべきか？
1コンテキスト1アプリケーションがシンプル
コンテキスト同士の通信はAPIやSQSを通じて行う。
